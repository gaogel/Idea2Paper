# Idea2Story Pipeline å®ç°è¯´æ˜

æœ¬æ–‡æ¡£è¯´æ˜ `idea2story_pipeline.py` çš„å®ç°ç»†èŠ‚å’Œä½¿ç”¨æ–¹æ³•ï¼ˆ2026å¹´1æœˆæœ€æ–°ç‰ˆæœ¬ï¼‰ã€‚

---

## ğŸ†• æœ€æ–°æ”¹è¿›ï¼ˆé‡è¦ï¼ï¼‰

### 1. æ–¹æ³•è®ºæ·±åº¦èåˆï¼ˆæ ¸å¿ƒæ”¹è¿›ï¼‰

**é—®é¢˜èƒŒæ™¯**:
- æ—©æœŸç‰ˆæœ¬åœ¨ Refinement é˜¶æ®µåªæ˜¯ç®€å•åœ°æ³¨å…¥ Trick åç§°ï¼ˆå¦‚"æ·»åŠ è¯¾ç¨‹å­¦ä¹ "ã€"ä½¿ç”¨å¯¹æŠ—è®­ç»ƒ"ï¼‰
- LLM å€¾å‘äºåœ¨ Story æœ«å°¾å †ç Œè¿™äº›æŠ€æœ¯åè¯ï¼Œè€ŒéçœŸæ­£èå…¥æ–¹æ³•é€»è¾‘

**è§£å†³æ–¹æ¡ˆ**:
1. **ä» `patterns_structured.json` æå–å®Œæ•´ `method_story`**: åŒ…å«å…·ä½“çš„æ–¹æ³•è®ºå®ç°ç»†èŠ‚ï¼ˆ150å­—å·¦å³ï¼‰
2. **é’ˆå°–å¼æ³¨å…¥**: å°†æå–çš„ `method_story` æ–‡æœ¬ç›´æ¥å†™å…¥ Promptï¼Œè€Œéä»…æä¾›æŠ€æœ¯åç§°
3. **å¼ºçº¦æŸ Prompt**: æä¾›æ­£åèŒƒä¾‹ï¼Œæ˜ç¡®è¦æ±‚"é‡æ„è€Œéå †ç Œ"ã€"ç»Ÿä¸€æ¡†æ¶è€Œéåˆ†æ•£æè¿°"

**ä»£ç ä½ç½®**:
- `RefinementEngine._inject_tail_tricks()` (è¡Œ 1000-1100)
- `RefinementEngine._inject_head_tricks()` (è¡Œ 1100-1150)
- `StoryGenerator._build_refinement_prompt()` (è¡Œ 329-384)

### 2. å¤šæºæ•°æ®åˆå¹¶ï¼ˆå…³é”®ä¿®å¤ï¼‰

**é—®é¢˜èƒŒæ™¯**:
- `nodes_pattern.json` åªåŒ…å«åŸºç¡€ Pattern ä¿¡æ¯ï¼ˆåç§°ã€æ‘˜è¦ã€top_tricksï¼‰
- `patterns_structured.json` åŒ…å«å®Œæ•´çš„ `skeleton_examples`ï¼ˆå« `method_story` å­—æ®µï¼‰
- æ—©æœŸç‰ˆæœ¬åªåŠ è½½å‰è€…ï¼Œå¯¼è‡´ Refinement é˜¶æ®µæ— æ³•è®¿é—®æ–¹æ³•è®ºæè¿°

**è§£å†³æ–¹æ¡ˆ**:
åœ¨ `Idea2StoryPipeline.run()` ä¸­ï¼ˆè¡Œ 1580-1602ï¼‰:
```python
# åŠ è½½ patterns_structured.json
with open(patterns_structured_file, 'r', encoding='utf-8') as f:
    patterns_structured = json.load(f)

# æ„å»ºæ˜ å°„
structured_map = {f"pattern_{p['pattern_id']}": p for p in patterns_structured}

# åˆå¹¶æ•°æ®
for p in patterns_data:
    pattern_id = p['pattern_id']
    merged_pattern = dict(p)
    if pattern_id in structured_map:
        merged_pattern['skeleton_examples'] = structured_map[pattern_id].get('skeleton_examples', [])
        merged_pattern['common_tricks'] = structured_map[pattern_id].get('common_tricks', [])
    pattern_map[pattern_id] = merged_pattern
```

### 3. å¢é‡ä¿®æ­£æ¨¡å¼

**é—®é¢˜èƒŒæ™¯**: æ—©æœŸç‰ˆæœ¬æ¯æ¬¡ä¿®æ­£éƒ½é‡æ–°ç”Ÿæˆæ•´ä¸ª Storyï¼Œå¯¼è‡´å¥½çš„éƒ¨åˆ†è¢«"å¿˜è®°"

**è§£å†³æ–¹æ¡ˆ**:
- `StoryGenerator.generate()` æ”¯æŒ `previous_story` å’Œ `review_feedback` å‚æ•°
- åœ¨ä¿®æ­£æ¨¡å¼ä¸‹ï¼ŒPrompt åŒ…å«ï¼š
  - ä¸Šä¸€ç‰ˆæœ¬çš„å®Œæ•´ Story
  - è¯„å®¡ä¸“å®¶çš„å…·ä½“åé¦ˆ
  - æœ¬è½®æ–°æ³¨å…¥çš„æ–¹æ³•è®ºæè¿°
- LLM è¢«è¦æ±‚"ä¿ç•™ç²¾åã€æ·±åº¦æ”¹é€ å·®è¯„éƒ¨åˆ†"

**ä»£ç ä½ç½®**:
- `StoryGenerator.generate()` (è¡Œ 203-277)
- `StoryGenerator._build_refinement_prompt()` (è¡Œ 329-384)

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡

### æ¨¡å—åˆ’åˆ†

```
Idea2StoryPipeline (ä¸»ç¼–æ’å™¨)
â”œâ”€â”€ PatternSelector        # Phase 1: ç­–ç•¥é€‰æ‹©
â”œâ”€â”€ StoryGenerator         # Phase 2: Story ç”Ÿæˆï¼ˆæ”¯æŒåˆæ¬¡ç”Ÿæˆå’Œå¢é‡ä¿®æ­£ï¼‰
â”œâ”€â”€ MultiAgentCritic       # Phase 3: å¤šæ™ºèƒ½ä½“è¯„å®¡
â”œâ”€â”€ RefinementEngine       # Phase 3.5: ä¿®æ­£æ³¨å…¥ï¼ˆæ–¹æ³•è®ºæ·±åº¦æ³¨å…¥ï¼‰
â””â”€â”€ RAGVerifier           # Phase 4: æŸ¥é‡éªŒè¯
```

### æ•°æ®æµ

```
User Idea
    â†“
[å¬å› Top-10 Patterns] (å¤ç”¨ simple_recall_demo.py)
    â†“
[Phase 1] é€‰æ‹© 3 ä¸ªå¤šæ ·åŒ– Pattern
    â†“
[Phase 2] ç”Ÿæˆåˆå§‹ Story Draft
    â†“
[Phase 3] å¤šæ™ºèƒ½ä½“è¯„å®¡ â”€â”€â†’ Pass? â”€â”€Yesâ”€â”€â†’ [Phase 4]
    â†“ No                                      â†“
[Phase 3.5] æ³¨å…¥ Trick ä¿®æ­£                   [RAG æŸ¥é‡]
    â†“                                          â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Pass? â”€â”€Yesâ”€â”€â†’ âœ… Final Story
                                              â†“ No
                                         [Pivot ç­–ç•¥]
                                              â†“
                                         [é‡æ–°ç”Ÿæˆ]
                                              â†“
                                         âœ… Final Story
```

---

## ğŸ“‹ ä½¿ç”¨æ–¹æ³•

### 1. ç¯å¢ƒé…ç½®

ç¡®ä¿å·²è®¾ç½® LLM API ç¯å¢ƒå˜é‡:

```bash
export SILICONFLOW_API_KEY="sk-your-api-key-here"
export LLM_API_URL="https://api.siliconflow.cn/v1/chat/completions"
export LLM_MODEL="Qwen/Qwen2.5-7B-Instruct"
```

### 2. è¿è¡Œ Pipeline

```bash
# ä½¿ç”¨é»˜è®¤ Idea
python scripts/idea2story_pipeline.py

# è‡ªå®šä¹‰ Idea
python scripts/idea2story_pipeline.py "ä½ çš„ç ”ç©¶æƒ³æ³•æè¿°"
```

### 3. æŸ¥çœ‹è¾“å‡º

**æ§åˆ¶å°è¾“å‡º**ï¼šå®Œæ•´çš„æ‰§è¡Œè¿‡ç¨‹ï¼ŒåŒ…æ‹¬å„é˜¶æ®µçš„è¯¦ç»†ä¿¡æ¯

**æ–‡ä»¶è¾“å‡º**ï¼š
- `output/final_story.json` - æœ€ç»ˆç”Ÿæˆçš„ Story
- `output/pipeline_result.json` - å®Œæ•´çš„æ‰§è¡Œç»“æœï¼ˆåŒ…æ‹¬è¿­ä»£å†å²ï¼‰

---

## âš™ï¸ é…ç½®å‚æ•°

æ‰€æœ‰é…ç½®åœ¨ `PipelineConfig` ç±»ä¸­:

### Pattern é€‰æ‹©

```python
SELECT_PATTERN_COUNT = 3  # é€‰æ‹© 3 ä¸ª Pattern
CONSERVATIVE_RANK_RANGE = (0, 2)  # ç¨³å¥å‹: Rank 1-3
INNOVATIVE_CLUSTER_SIZE_THRESHOLD = 10  # åˆ›æ–°å‹: Cluster Size < 10
```

### Critic é˜ˆå€¼

```python
PASS_SCORE = 6.0  # è¯„åˆ† >= 6 ä¸ºé€šè¿‡
MAX_REFINE_ITERATIONS = 3  # æœ€å¤šä¿®æ­£ 3 è½®
```

### RAG æŸ¥é‡

```python
COLLISION_THRESHOLD = 0.75  # ç›¸ä¼¼åº¦ > 0.75 è®¤ä¸ºæ’è½¦
```

### Refinement ç­–ç•¥

```python
TAIL_INJECTION_RANK_RANGE = (4, 9)  # é•¿å°¾æ³¨å…¥: Rank 5-10
HEAD_INJECTION_RANK_RANGE = (0, 2)  # å¤´éƒ¨æ³¨å…¥: Rank 1-3
HEAD_INJECTION_CLUSTER_THRESHOLD = 15  # å¤´éƒ¨: Cluster Size > 15
```

---

## ğŸ”§ å„æ¨¡å—è¯¦è§£

### Phase 1: Pattern Selection

**ç›®æ ‡**: ä»å¬å›çš„ Top-10 ä¸­é€‰æ‹© 3 ä¸ªå¤šæ ·åŒ–çš„ Pattern

**ç­–ç•¥**:
1. **ç¨³å¥å‹ (Conservative)**: Score æœ€é«˜ï¼Œæœ€ç¬¦åˆç›´è§‰
2. **åˆ›æ–°å‹ (Innovative)**: Cluster Size < 10ï¼Œå®¹æ˜“äº§ç”Ÿæ–°é¢–ç»“åˆ
3. **è·¨åŸŸå‹ (Cross-Domain)**: æ¥è‡ªè·¯å¾„ 2 æˆ–è·¯å¾„ 3

**è¾“å‡ºç¤ºä¾‹**:
```
âœ… [ç¨³å¥å‹] pattern_11
   åç§°: æ¨¡å‹å‹ç¼©ä¸çŸ¥è¯†è’¸é¦
   èšç±»å¤§å°: 30 ç¯‡
   ç­–ç•¥: Score æœ€é«˜ï¼Œæœ€ç¬¦åˆç›´è§‰

âœ… [åˆ›æ–°å‹] pattern_23
   åç§°: è¯¾ç¨‹å­¦ä¹ è°ƒåº¦
   èšç±»å¤§å°: 5 ç¯‡
   ç­–ç•¥: Cluster Size < 10ï¼Œå®¹æ˜“äº§ç”Ÿæ–°é¢–ç»“åˆ

âœ… [è·¨åŸŸå‹] pattern_17
   åç§°: ç»“æ„å›¾è°±é¢„æµ‹æ–¹æ³•
   èšç±»å¤§å°: 15 ç¯‡
   ç­–ç•¥: æ¥è‡ªé¢†åŸŸç›¸å…³æˆ–Paperç›¸ä¼¼è·¯å¾„
```

### Phase 2: Story Generation

**ç›®æ ‡**: åŸºäº Idea + Pattern ç”Ÿæˆç»“æ„åŒ– Story

**è¾“å…¥**:
- User Idea
- Pattern (å« Skeleton ç¤ºä¾‹ã€é«˜é¢‘ Tricks)
- Constraints (å¯é€‰ï¼Œç”¨äº Pivot)
- Injected Tricks (å¯é€‰ï¼Œç”¨äº Refinement)

**è¾“å‡ºç»“æ„**:
```json
{
  "title": "è®ºæ–‡æ ‡é¢˜",
  "abstract": "æ‘˜è¦ï¼ˆ150-200å­—ï¼‰",
  "problem_definition": "é—®é¢˜å®šä¹‰ï¼ˆ50-80å­—ï¼‰",
  "method_skeleton": "æ–¹æ³•æ­¥éª¤ï¼ˆåˆ†å·åˆ†éš”ï¼‰",
  "innovation_claims": ["è´¡çŒ®1", "è´¡çŒ®2", "è´¡çŒ®3"],
  "experiments_plan": "å®éªŒè®¾è®¡ï¼ˆ50-80å­—ï¼‰"
}
```

**Prompt è®¾è®¡**:
- åŒ…å« Pattern çš„ Skeleton ç¤ºä¾‹ï¼ˆå‰ 2 ä¸ªï¼‰
- åŒ…å« Pattern çš„é«˜é¢‘ Tricksï¼ˆå‰ 5 ä¸ªï¼‰
- åŒ…å«çº¦æŸæ¡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
- åŒ…å«æ³¨å…¥çš„ Tricksï¼ˆå¦‚æœæœ‰ï¼Œå¼ºåˆ¶è¦æ±‚èåˆï¼‰

### Phase 3: Multi-Agent Critic

**ç›®æ ‡**: æ¨¡æ‹Ÿ Peer Reviewï¼Œæä¾›æ‰“åˆ†å’Œä¿®æ”¹æ–¹å‘

**è¯„å®¡è§’è‰²**:
1. **Reviewer A (Methodology)**: å…³æ³¨æŠ€æœ¯åˆç†æ€§
2. **Reviewer B (Novelty)**: å…³æ³¨åˆ›æ–°æ€§
3. **Reviewer C (Storyteller)**: å…³æ³¨å™äº‹å®Œæ•´æ€§

**è¾“å‡º**:
```json
{
  "pass": false,
  "avg_score": 5.2,
  "reviews": [
    {
      "reviewer": "Reviewer A",
      "role": "Methodology",
      "score": 6.5,
      "feedback": "æŠ€æœ¯æ–¹æ¡ˆåˆç†ï¼Œä½†ç¨³å®šæ€§æœ‰å¾…éªŒè¯..."
    },
    {
      "reviewer": "Reviewer B",
      "role": "Novelty",
      "score": 4.0,
      "feedback": "åˆ›æ–°æ€§ä¸è¶³ï¼Œç±»ä¼¼å·¥ä½œè¾ƒå¤š..."
    },
    ...
  ],
  "main_issue": "novelty",
  "suggestions": ["æ³¨å…¥å†·é—¨ Trick æå‡æ–°é¢–æ€§", "å¯»æ‰¾é•¿å°¾ Pattern"]
}
```

**è¯Šæ–­é€»è¾‘**:
- æ‰¾å‡ºåˆ†æ•°æœ€ä½çš„è¯„å®¡å‘˜
- æ ¹æ®å…¶è§’è‰²åˆ¤æ–­ä¸»è¦é—®é¢˜:
  - `Novelty` â†’ `novelty` (æ–°é¢–æ€§ä¸è¶³)
  - `Methodology` â†’ `stability` (ç¨³å®šæ€§ä¸è¶³)
  - `Storyteller` â†’ `interpretability` (å¯è§£é‡Šæ€§ä¸è¶³)

### Phase 3.5: Refinement Engine

**ç›®æ ‡**: æ ¹æ® Critic åé¦ˆè¿›è¡Œ Pattern Injectionï¼ˆæ–¹æ³•è®ºæ·±åº¦èåˆï¼‰

**ç­–ç•¥è¡¨**:

| é—®é¢˜ç±»å‹ | è¯Šæ–­ | æ³¨å…¥ç­–ç•¥ | æ³¨å…¥æº | ç¤ºä¾‹ |
|---------|-----|---------|-------|-----|
| `novelty` | æ–¹æ³•å¤ªå¹³åº¸ | **Tail Injection** | Rank 5-10, Cluster Size < 10 | æ³¨å…¥å®Œæ•´çš„ method_storyï¼ˆå¦‚"æ„å»ºåŸºäºéš¾åº¦çš„è¯¾ç¨‹å­¦ä¹ è°ƒåº¦å™¨ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­åŠ¨æ€è°ƒæ•´æ ·æœ¬æƒé‡..."ï¼‰ |
| `stability` | ç»“æœä¸ç¨³å®š | **Head Injection** | Rank 1-3, Cluster Size > 15 | æ³¨å…¥ç¨³å®šæ€§æ–¹æ³•è®ºæè¿°ï¼ˆå¦‚"é‡‡ç”¨å¤šç§å­éªŒè¯æœºåˆ¶ï¼Œå¯¹æ¯ä¸ªå®éªŒé…ç½®è¿è¡Œ5æ¬¡..."ï¼‰ |
| `interpretability` | ç¼ºä¹è§£é‡Š | **Explanation Injection** | å›ºå®š Tricks | æ³¨å…¥"Attentionå¯è§†åŒ–"ã€"Case Study" |
| `domain_mismatch` | é¢†åŸŸä¸é€‚é… | **Domain Adaptation** | å›ºå®š Tricks | æ³¨å…¥"é¢†åŸŸé¢„å¤„ç†"ã€"ç‰¹å¾å·¥ç¨‹" |

**å…³é”®æ”¹è¿›** (æ–°å¢):
- **ä» Trick åç§°åˆ°æ–¹æ³•è®º**: ä¸å†åªæ³¨å…¥"è¯¾ç¨‹å­¦ä¹ "ã€"å¯¹æŠ—è®­ç»ƒ"ç­‰åè¯ï¼Œè€Œæ˜¯æ³¨å…¥å®Œæ•´çš„ `method_story` æ–‡æœ¬ï¼ˆ150å­—ï¼‰
- **æ™ºèƒ½ç­›é€‰**: ä¼˜å…ˆæå–åŒ…å«ç¨³å®šæ€§å…³é”®è¯ï¼ˆç¨³å®š/é²æ£’/å¯¹æŠ—/æ­£åˆ™/æ··åˆï¼‰çš„æ–¹æ³•è®º
- **Prompt å¼ºçº¦æŸ**: æä¾›æ­£åèŒƒä¾‹ï¼Œæ˜ç¡®è¦æ±‚"æ·±åº¦é‡æ„"è€Œé"ç®€å•è¿½åŠ "

**è¾“å‡ºç¤ºä¾‹** (æ–°ç‰ˆæœ¬):
```
ğŸ¯ ç­–ç•¥: Tail Injection (é•¿å°¾æ³¨å…¥)
   ç›®æ ‡: ä» Rank 5-10 ä¸­é€‰æ‹© Cluster Size < 10 çš„å†·é—¨ Pattern

   âœ… é€‰æ‹© Pattern: pattern_23
      åç§°: è¯¾ç¨‹å­¦ä¹ è°ƒåº¦
      èšç±»å¤§å°: 5 ç¯‡ï¼ˆå†·é—¨ï¼‰
      æ³¨å…¥æ–¹æ³•è®º 1: æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªåŸºäºæ ·æœ¬éš¾åº¦çš„è¯¾ç¨‹å­¦ä¹ è°ƒåº¦å™¨ã€‚
                     é¦–å…ˆï¼Œé€šè¿‡é¢„è®­ç»ƒæ¨¡å‹è®¡ç®—æ¯ä¸ªæ ·æœ¬çš„é¢„æµ‹ç½®ä¿¡åº¦ä½œä¸º
                     éš¾åº¦æŒ‡æ ‡ï¼›ç„¶åï¼Œåœ¨è®­ç»ƒæ—©æœŸä»…ä½¿ç”¨ç®€å•æ ·æœ¬ï¼Œéšè®­ç»ƒ
                     è¿›ç¨‹é€æ­¥å¼•å…¥å›°éš¾æ ·æœ¬ï¼Œæœ€ç»ˆå®ç°ç¨³å®šçš„æ¨¡å‹æ”¶æ•›...
      æ³¨å…¥æŠ€æœ¯: è¯¾ç¨‹å­¦ä¹ è°ƒåº¦å™¨ + æ ·æœ¬éš¾åº¦è¯„ä¼°
```

### Phase 4: RAG Verification

**ç›®æ ‡**: æŸ¥é‡å¹¶è§¦å‘ Pivot ç­–ç•¥

**æŸ¥é‡é€»è¾‘**:
1. æå– Story çš„ `method_skeleton`
2. ä¸ç°æœ‰è®ºæ–‡çš„ `method_story` è®¡ç®—ç›¸ä¼¼åº¦ï¼ˆJaccardï¼‰
3. æ‰¾å‡ºæœ€ç›¸ä¼¼çš„è®ºæ–‡

**Collision åˆ¤æ–­**:
- ç›¸ä¼¼åº¦ > `COLLISION_THRESHOLD` (é»˜è®¤ 0.75)

**Pivot ç­–ç•¥**:
å¦‚æœæ£€æµ‹åˆ°æ’è½¦ï¼Œç”Ÿæˆçº¦æŸ:
1. ç¦æ­¢ä½¿ç”¨ä¸æ’è½¦è®ºæ–‡ç›¸åŒçš„æ ¸å¿ƒæŠ€æœ¯
2. å°†åº”ç”¨åœºæ™¯è¿ç§»åˆ°æ–°é¢†åŸŸ
3. å¢åŠ é¢å¤–çš„çº¦æŸæ¡ä»¶ï¼ˆå¦‚æ— ç›‘ç£ã€å°‘æ ·æœ¬ï¼‰

ç„¶ååˆ‡æ¢åˆ° `innovative` æˆ– `cross_domain` Pattern é‡æ–°ç”Ÿæˆã€‚

---

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

### æ§åˆ¶å°è¾“å‡º

```
================================================================================
ğŸš€ Idea2Story Pipeline å¯åŠ¨
================================================================================

ã€ç”¨æˆ· Ideaã€‘
ä½¿ç”¨è’¸é¦æŠ€æœ¯å®ŒæˆTransformerè·¨é¢†åŸŸæ–‡æœ¬åˆ†ç±»ä»»åŠ¡ï¼Œå¹¶åœ¨å¤šä¸ªæ•°æ®é›†ä¸ŠéªŒè¯æ•ˆæœ

================================================================================
ğŸ“‹ Phase 1: Pattern Selection (ç­–ç•¥é€‰æ‹©)
================================================================================

âœ… [ç¨³å¥å‹] pattern_11
   åç§°: æ¨¡å‹å‹ç¼©ä¸çŸ¥è¯†è’¸é¦
   èšç±»å¤§å°: 30 ç¯‡
   ç­–ç•¥: Score æœ€é«˜ï¼Œæœ€ç¬¦åˆç›´è§‰

...

================================================================================
ğŸ”„ è¿­ä»£è½®æ¬¡: 1/3
================================================================================

ğŸ“ ç”Ÿæˆ Story (åŸºäº pattern_11)
   â³ è°ƒç”¨ LLM ç”Ÿæˆ...

   ğŸ“„ ç”Ÿæˆçš„ Story:
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   æ ‡é¢˜: è‡ªé€‚åº”è’¸é¦æ¡†æ¶åœ¨è·¨åŸŸæ–‡æœ¬åˆ†ç±»ä¸­çš„åº”ç”¨
   æ‘˜è¦: æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ–°çš„è‡ªé€‚åº”è’¸é¦æ¡†æ¶...
   ...

================================================================================
ğŸ” Phase 3: Multi-Agent Critic (å¤šæ™ºèƒ½ä½“è¯„å®¡)
================================================================================

ğŸ“ Reviewer A (Methodology) è¯„å®¡ä¸­...
   è¯„åˆ†: 7.5/10
   åé¦ˆ: æŠ€æœ¯æ–¹æ¡ˆåˆç†ï¼Œä½†éœ€è¦éªŒè¯è·¨åŸŸåœºæ™¯çš„ç¨³å®šæ€§...

ğŸ“ Reviewer B (Novelty) è¯„å®¡ä¸­...
   è¯„åˆ†: 4.0/10
   åé¦ˆ: åˆ›æ–°æ€§ä¸è¶³ï¼Œç°æœ‰å·¥ä½œè¾ƒå¤š...

ğŸ“ Reviewer C (Storyteller) è¯„å®¡ä¸­...
   è¯„åˆ†: 6.5/10
   åé¦ˆ: å™äº‹è¾ƒå®Œæ•´ï¼Œä½†ç¼ºå°‘ä¸€äº›å®éªŒç»†èŠ‚...

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Š è¯„å®¡ç»“æœ: å¹³å‡åˆ† 6.00/10 - âŒ FAIL
ğŸ”§ ä¸»è¦é—®é¢˜: novelty
ğŸ’¡ å»ºè®®: æ³¨å…¥å†·é—¨ Trick æå‡æ–°é¢–æ€§, å¯»æ‰¾é•¿å°¾ Pattern
================================================================================

...

================================================================================
ğŸ‰ Pipeline å®Œæˆ!
================================================================================
âœ… çŠ¶æ€: æˆåŠŸ
ğŸ“Š è¿­ä»£æ¬¡æ•°: 2
ğŸ“ æœ€ç»ˆ Story:
   æ ‡é¢˜: è‡ªé€‚åº”è’¸é¦æ¡†æ¶åœ¨è·¨åŸŸæ–‡æœ¬åˆ†ç±»ä¸­çš„åº”ç”¨
   æ‘˜è¦: æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ–°çš„è‡ªé€‚åº”è’¸é¦æ¡†æ¶...
================================================================================

ğŸ’¾ æœ€ç»ˆ Story å·²ä¿å­˜åˆ°: output/final_story.json
ğŸ’¾ å®Œæ•´ç»“æœå·²ä¿å­˜åˆ°: output/pipeline_result.json
```

### pipeline_result.json

```json
{
  "user_idea": "ä½¿ç”¨è’¸é¦æŠ€æœ¯å®ŒæˆTransformerè·¨é¢†åŸŸæ–‡æœ¬åˆ†ç±»ä»»åŠ¡...",
  "success": true,
  "iterations": 2,
  "selected_patterns": {
    "conservative": "pattern_11",
    "innovative": "pattern_23",
    "cross_domain": "pattern_17"
  },
  "final_story": {
    "title": "è‡ªé€‚åº”è’¸é¦æ¡†æ¶åœ¨è·¨åŸŸæ–‡æœ¬åˆ†ç±»ä¸­çš„åº”ç”¨",
    ...
  },
  "review_summary": {
    "total_reviews": 2,
    "final_score": 7.5
  },
  "refinement_summary": {
    "total_refinements": 1,
    "issues_addressed": ["novelty"]
  },
  "verification_summary": {
    "collision_detected": false,
    "max_similarity": 0.62
  }
}
```

---

## ğŸ” è°ƒè¯•å»ºè®®

### 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

æ‰€æœ‰å…³é”®æ­¥éª¤éƒ½æœ‰æ‰“å°è¾“å‡ºï¼ŒåŒ…æ‹¬:
- Pattern é€‰æ‹©çš„è¯¦ç»†ä¿¡æ¯
- Story ç”Ÿæˆçš„ Prompt å’Œç»“æœ
- æ¯ä¸ªè¯„å®¡å‘˜çš„æ‰“åˆ†å’Œåé¦ˆ
- Refinement æ³¨å…¥çš„ Trick
- RAG æŸ¥é‡çš„ç›¸ä¼¼è®ºæ–‡

### 2. è°ƒæ•´å‚æ•°

å¦‚æœæ•ˆæœä¸ç†æƒ³ï¼Œå¯ä»¥è°ƒæ•´:
- `PASS_SCORE`: é™ä½é€šè¿‡é—¨æ§›
- `MAX_REFINE_ITERATIONS`: å¢åŠ è¿­ä»£æ¬¡æ•°
- `COLLISION_THRESHOLD`: è°ƒæ•´æŸ¥é‡æ•æ„Ÿåº¦
- `INNOVATIVE_CLUSTER_SIZE_THRESHOLD`: è°ƒæ•´åˆ›æ–°å‹ Pattern é€‰æ‹©æ ‡å‡†

### 3. æ¨¡æ‹Ÿæ¨¡å¼

å¦‚æœæ²¡æœ‰é…ç½® LLM APIï¼Œç³»ç»Ÿä¼šä½¿ç”¨æ¨¡æ‹Ÿè¾“å‡ºï¼Œå¯ä»¥å¿«é€Ÿæµ‹è¯•æµç¨‹ã€‚

---

## ğŸš€ ä¼˜åŒ–æ–¹å‘

### å·²å®ç°çš„æ ¸å¿ƒä¼˜åŒ–ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰

âœ… **æ–¹æ³•è®ºæ·±åº¦èåˆ**: ä» `patterns_structured.json` æå–å®Œæ•´ `method_story`ï¼Œé’ˆå°–å¼æ³¨å…¥åˆ° Prompt
âœ… **å¢é‡ä¿®æ­£æ¨¡å¼**: æ”¯æŒ `previous_story` å’Œ `review_feedback` å‚æ•°ï¼Œä¿ç•™ç²¾åã€é’ˆå¯¹æ€§æ”¹é€ 
âœ… **å¤šæºæ•°æ®åˆå¹¶**: è‡ªåŠ¨åˆå¹¶ `nodes_pattern.json` å’Œ `patterns_structured.json`
âœ… **å¼ºçº¦æŸ Prompt**: æä¾›æ­£åèŒƒä¾‹ï¼Œå¼•å¯¼ LLM è¿›è¡Œæ–¹æ³•è®ºé‡æ„
âœ… **å¤šæ ·åŒ– Pattern é€‰æ‹©**: ç¨³å¥å‹/åˆ›æ–°å‹/è·¨åŸŸå‹ä¸‰ç§ç­–ç•¥
âœ… **å¤šæ™ºèƒ½ä½“è¯„å®¡æœºåˆ¶**: Methodology/Novelty/Storyteller ä¸‰è§’è‰²
âœ… **Pivot ç­–ç•¥é¿å…æ’è½¦**: RAG æŸ¥é‡ + é¢†åŸŸè¿ç§»
âœ… **å¥å£® JSON è§£æ**: é¢„å¤„ç† + æ­£åˆ™ä¿®å¤ + Fallback æå–

### å¯è¿›ä¸€æ­¥ä¼˜åŒ–

1. **å¹¶è¡Œç”Ÿæˆ**: åŒæ—¶ç”Ÿæˆ 3 ä¸ª Pattern çš„ Storyï¼Œé€‰æ‹©æœ€ä½³ï¼ˆå½“å‰æ˜¯ä¸²è¡Œï¼‰
2. **è¯­ä¹‰ç›¸ä¼¼åº¦é€‰æ‹©**: åŸºäº Trick çš„è¯­ä¹‰ç›¸ä¼¼åº¦æ™ºèƒ½é€‰æ‹©æ³¨å…¥å†…å®¹ï¼ˆå½“å‰åŸºäºå…³é”®è¯ï¼‰
3. **RAG å‘é‡æ£€ç´¢**: ä½¿ç”¨ Embedding ç›¸ä¼¼åº¦æ›¿ä»£ Jaccard ç›¸ä¼¼åº¦ï¼ˆå½“å‰æ˜¯å­—ç¬¦ä¸²åŒ¹é…ï¼‰
4. **äººæœºååŒæ¨¡å¼**: åœ¨å…³é”®èŠ‚ç‚¹åŠ å…¥äººå·¥å®¡æ ¸ç‚¹ï¼ˆå½“å‰æ˜¯å…¨è‡ªåŠ¨ï¼‰
5. **é¢†åŸŸè‡ªé€‚åº”**: æ ¹æ® Idea æ‰€å±é¢†åŸŸåŠ¨æ€è°ƒæ•´ Pattern æƒé‡ï¼ˆå½“å‰æ˜¯å›ºå®šæƒé‡ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `README.md` - é¡¹ç›®æ•´ä½“è¯´æ˜
- `IDEA_TO_STORY_PIPELINE.md` - Pipeline è®¾è®¡æ–‡æ¡£
- `simple_recall_demo.py` - å¬å›ç³»ç»Ÿå®ç°

---

## â“ å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆè¯„å®¡ä¸€ç›´ä¸é€šè¿‡ï¼Ÿ**
A: å¯ä»¥é™ä½ `PASS_SCORE` æˆ–å¢åŠ  `MAX_REFINE_ITERATIONS`ã€‚ä¹Ÿå¯èƒ½æ˜¯ LLM è¾“å‡ºä¸ç¨³å®šï¼Œå»ºè®®è°ƒæ•´ temperatureã€‚

**Q: å¦‚ä½•è‡ªå®šä¹‰è¯„å®¡è§’è‰²ï¼Ÿ**
A: ä¿®æ”¹ `MultiAgentCritic.__init__()` ä¸­çš„ `self.reviewers` åˆ—è¡¨ã€‚

**Q: å¦‚ä½•ä½¿ç”¨è‡ªå·±çš„ LLMï¼Ÿ**
A: ä¿®æ”¹ `call_llm()` å‡½æ•°ï¼Œé€‚é…ä½ çš„ API æ¥å£ã€‚

**Q: å¦‚ä½•ç¦ç”¨æŸä¸ª Phaseï¼Ÿ**
A: åœ¨ `Idea2StoryPipeline.run()` ä¸­æ³¨é‡Šæ‰å¯¹åº”çš„é˜¶æ®µã€‚

---

**æœ€åæ›´æ–°**: 2026-01-12

**é‡è¦æ”¹è¿›**:
- æ–¹æ³•è®ºæ·±åº¦èåˆï¼ˆä»æŠ€æœ¯å †ç Œåˆ°æ·±åº¦é‡æ„ï¼‰
- å¤šæºæ•°æ®åˆå¹¶ï¼ˆè®¿é—®å®Œæ•´çš„ skeleton_examplesï¼‰
- å¢é‡ä¿®æ­£æ¨¡å¼ï¼ˆä¿ç•™ç²¾åã€é’ˆå¯¹æ€§æ”¹é€ ï¼‰

