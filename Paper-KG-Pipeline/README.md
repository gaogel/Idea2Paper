# Paper-Knowledge-Graph-Pipeline è¿è¡ŒæŒ‡å—

è¿™æ˜¯ä¸€ä¸ªåŸºäºè®ºæ–‡çŸ¥è¯†å›¾è°±çš„ Pattern ç”Ÿæˆä¸ Idea å¬å›ç³»ç»Ÿã€‚æœ¬æŒ‡å—å¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹æœ€æ–°ç‰ˆæœ¬ï¼ˆ2026å¹´1æœˆæ›´æ–°ï¼‰ã€‚

---

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

```bash
# æ£€æŸ¥ Python ç‰ˆæœ¬ï¼ˆå»ºè®® 3.8+ï¼‰
python --version

# å®‰è£…ä¾èµ–
pip install numpy scikit-learn requests networkx
```

### ç¯å¢ƒå˜é‡é…ç½®

ç³»ç»Ÿéœ€è¦ **SiliconFlow API** æ¥ç”Ÿæˆ Embeddings å’Œè°ƒç”¨ LLMã€‚å‚è€ƒ `01_RAG_minimal_DEMO.ipynb` è¿›è¡Œé…ç½®ï¼š

```bash
# æ–¹å¼1ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰
export SILICONFLOW_API_KEY="sk-your-api-key-here"
export LLM_API_URL="https://api.siliconflow.cn/v1/chat/completions"
export EMBED_API_URL="https://api.siliconflow.cn/v1/embeddings"
export LLM_MODEL="Qwen/Qwen2.5-7B-Instruct"
export EMBED_MODEL="Qwen/Qwen3-Embedding-4B"

# æˆ–æ–¹å¼2ï¼šåœ¨è„šæœ¬ä¸­ç›´æ¥é…ç½®ï¼ˆè§å„è„šæœ¬çš„é…ç½®éƒ¨åˆ†ï¼‰
```

---

## ğŸ”§ å®Œæ•´å·¥ä½œæµ

### Step 1: æ•°æ®å‡†å¤‡

ç¡®ä¿æ•°æ®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
data/
â”œâ”€â”€ ACL_2017/
â”‚   â”œâ”€â”€ paper_0_paper_node.json
â”‚   â”œâ”€â”€ paper_1_paper_node.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ COLING_2020/
â”‚   â”œâ”€â”€ paper_0_paper_node.json
â”‚   â””â”€â”€ ...
â””â”€â”€ ARR_2022/
    â””â”€â”€ ...
```

æ¯ä¸ª `*_paper_node.json` æ–‡ä»¶åº”åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
```json
{
  "paper_id": "...",
  "title": "...",
  "conference": "...",
  "skeleton": {
    "problem_framing": "...",
    "gap_pattern": "...",
    "method_story": "...",
    "experiments_story": "..."
  },
  "tricks": [
    {
      "name": "æŠ€å·§åç§°",
      "type": "...",
      "description": "...",
      "purpose": "..."
    }
  ]
}
```

### Step 2: ç”Ÿæˆ Patternï¼ˆå¯é€‰ï¼Œå¦‚å·²æœ‰ patterns_structured.json å¯è·³è¿‡ï¼‰

```bash
cd scripts
python generate_patterns.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
================================================================================
åŸºäº Skeleton + Tricks èšç±»ç”Ÿæˆ Patterns
================================================================================

ã€Step 1ã€‘åŠ è½½è®ºæ–‡æ•°æ®
  ğŸ“ åŠ è½½ ACL_2017: 123 ç¯‡è®ºæ–‡
  ğŸ“ åŠ è½½ COLING_2020: 234 ç¯‡è®ºæ–‡
  âœ… å…±åŠ è½½ 545 ç¯‡è®ºæ–‡

ã€Step 2ã€‘æ„å»ºpattern embeddings
  âœ“ å®Œæˆ 545 ä¸ªpatternçš„embedding

ã€Step 3ã€‘èšç±»
ğŸ”„ å¼€å§‹èšç±»...
  è·ç¦»é˜ˆå€¼: 0.35
  âœ“ ç”Ÿæˆ 34 ä¸ª clusters
  ğŸ“Š Cluster å¤§å°åˆ†å¸ƒ:
    Cluster 0: 8 ç¯‡
    Cluster 1: 12 ç¯‡
    ...

ã€Step 4ã€‘ç”Ÿæˆpatterns
  ğŸ“Š åˆ†æ Cluster 0 (8 ç¯‡)...
    Pattern 1: æ¨¡å‹å‹ç¼©ä¸çŸ¥è¯†è’¸é¦...
  ...
  âœ… å…±ç”Ÿæˆ 34 ä¸ªpatterns

ã€Step 5ã€‘ç”Ÿæˆè¾“å‡ºæ–‡ä»¶
  âœ… patterns_structured.json
  âœ… paper_to_pattern.json
  âœ… patterns_guide.txt
  âœ… patterns_statistics.json
```

### Step 3: æ„å»ºçŸ¥è¯†å›¾è°±

```bash
# æ„å»ºå®ä½“èŠ‚ç‚¹
python build_entity.py

# æ„å»ºè¾¹å…³ç³»
python build_edges.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
âœ… å·²ç”Ÿæˆï¼š
  - output/nodes_idea.json (545 ä¸ªIdeaèŠ‚ç‚¹)
  - output/nodes_pattern.json (34 ä¸ªPatternèŠ‚ç‚¹)
  - output/nodes_domain.json (257 ä¸ªDomainèŠ‚ç‚¹)
  - output/nodes_paper.json (545 ä¸ªPaperèŠ‚ç‚¹)
  - output/edges_*.json (å„ç±»è¾¹å…³ç³»)
```

### Step 4: è¿è¡Œå¬å›ç³»ç»Ÿæ¼”ç¤º

```bash
python simple_recall_demo.py
```

**äº¤äº’å¼è¾“å…¥**ï¼š
```
è¯·è¾“å…¥ Ideaï¼ˆæˆ–æŒ‰ Enter ä½¿ç”¨é»˜è®¤ç¤ºä¾‹ï¼‰:
ä½¿ç”¨è’¸é¦æŠ€æœ¯å®ŒæˆTransformerè·¨é¢†åŸŸæ–‡æœ¬åˆ†ç±»ä»»åŠ¡ï¼Œå¹¶åœ¨å¤šä¸ªæ•°æ®é›†ä¸ŠéªŒè¯æ•ˆæœ
```

**é¢„æœŸè¾“å‡º**ï¼š
```
================================================================================
ğŸ¯ ä¸‰è·¯å¬å›ç³»ç»Ÿ Demo
================================================================================

ã€ç”¨æˆ·Ideaã€‘
ä½¿ç”¨è’¸é¦æŠ€æœ¯å®ŒæˆTransformerè·¨é¢†åŸŸæ–‡æœ¬åˆ†ç±»ä»»åŠ¡ï¼Œå¹¶åœ¨å¤šä¸ªæ•°æ®é›†ä¸ŠéªŒè¯æ•ˆæœ

ğŸ“‚ åŠ è½½æ•°æ®...
  âœ“ Idea: 545, Pattern: 34, Domain: 257, Paper: 545
  âœ“ å›¾è°±: 1381 èŠ‚ç‚¹, 4509 è¾¹

ğŸ” [è·¯å¾„1] ç›¸ä¼¼Ideaå¬å›...
  æ‰¾åˆ° 523 ä¸ªç›¸ä¼¼Ideaï¼Œé€‰æ‹© Top-10
  âœ“ å¬å› 5 ä¸ªPattern

ğŸŒ [è·¯å¾„2] é¢†åŸŸç›¸å…³æ€§å¬å›...
  æ‰¾åˆ° 3 ä¸ªç›¸å…³Domainï¼Œé€‰æ‹© Top-5
  âœ“ å¬å› 34 ä¸ªPattern

ğŸ“„ [è·¯å¾„3] ç›¸ä¼¼Paperå¬å›...
  æ‰¾åˆ° 171 ä¸ªç›¸ä¼¼Paperï¼Œé€‰æ‹© Top-20
  âœ“ å¬å› 9 ä¸ªPattern

ğŸ”— èåˆä¸‰è·¯å¬å›ç»“æœ...

================================================================================
ğŸ“Š å¬å›ç»“æœ Top-10
================================================================================

ã€Rank 1ã€‘ pattern_11
  åç§°: æ¨¡å‹å‹ç¼©ä¸çŸ¥è¯†è’¸é¦
  æœ€ç»ˆå¾—åˆ†: 0.1312
  - è·¯å¾„1 (ç›¸ä¼¼Idea):   0.1049 (å æ¯” 79.9%)
  - è·¯å¾„2 (é¢†åŸŸç›¸å…³):   0.0030 (å æ¯” 2.3%)
  - è·¯å¾„3 (ç›¸ä¼¼Paper):  0.0233 (å æ¯” 17.8%)
  èšç±»å¤§å°: 5 ç¯‡è®ºæ–‡
  æ‘˜è¦: ...

ã€Rank 2ã€‘ pattern_17
  åç§°: ç»“æ„å›¾è°±é¢„æµ‹æ–¹æ³•
  æœ€ç»ˆå¾—åˆ†: 0.1249
  ...

================================================================================
âœ… å¬å›å®Œæˆ!
================================================================================
```

---

## ğŸ“Š å…³é”®æ”¹è¿›ç‚¹ï¼ˆç›¸æ¯”æ—§ç‰ˆæœ¬ï¼‰

### Pattern èšç±»ä¼˜åŒ–

| æ–¹é¢ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ | æ”¹è¿› |
| :--- | :--- | :--- | :--- |
| **èšç±»ç­–ç•¥** | å›ºå®š 30 ä¸ªç°‡ | è‡ªé€‚åº”è·ç¦»é˜ˆå€¼ | âœ… æ›´åˆç† |
| **Pattern æ€»æ•°** | 30 ä¸ª | 34 ä¸ª | âœ… é€‰æ‹©æ›´å¤š |
| **æœ€å¤§ Pattern** | 448 ç¯‡(82%) | 30 ç¯‡(8.6%) | âœ… æ¶ˆé™¤"ä¸‡é‡‘æ²¹" |
| **æœ€å° Pattern** | 2 ç¯‡(è´¨é‡ä½) | 5 ç¯‡(æœ‰ç­›é€‰) | âœ… è´¨é‡ä¿è¯ |
| **ä¸­ä½æ•°ç°‡å¤§å°** | 2 ç¯‡ | 8.5 ç¯‡ | âœ… ä»£è¡¨æ€§å¼º |
| **ä¸­æ–‡ Idea å¬å›** | 0 ä¸ªç»“æœ | ç²¾å‡†å¬å› | âœ… ä¿®å¤ bug |

### å‚æ•°é…ç½®

```python
# èšç±»å‚æ•°ï¼ˆä½äº scripts/generate_patterns.pyï¼‰
CLUSTER_PARAMS = {
    "distance_threshold": 0.35,  # è‡ªé€‚åº”èšç±»çš„è·ç¦»é˜ˆå€¼
    "min_cluster_size": 5,       # æœ€å°ç°‡å¤§å°ï¼Œä½äºæ­¤å€¼çš„ç°‡è¢«è¿‡æ»¤
    "skeleton_weight": 0.4,      # Skeleton æƒé‡ï¼ˆéª¨æ¶ï¼‰
    "tricks_weight": 0.6,        # Tricks æƒé‡ï¼ˆæŠ€å·§ï¼‰
}
```

**å¦‚ä½•è°ƒæ•´**ï¼š
- é™ä½ `distance_threshold`ï¼šç”Ÿæˆæ›´å¤šã€æ›´ç²¾ç»†çš„ Patternï¼ˆæ¨è 0.30-0.35ï¼‰
- å¢åŠ  `min_cluster_size`ï¼šåªä¿ç•™æ›´å¤§çš„ã€ä»£è¡¨æ€§æ›´å¼ºçš„ç°‡ï¼ˆæ¨è 5-10ï¼‰
- è°ƒæ•´ weightsï¼šæ”¹å˜ Skeleton å’Œ Tricks åœ¨èšç±»ä¸­çš„é‡è¦æ€§æ¯”ä¾‹

---

## ğŸ” ç†è§£å¬å›ç³»ç»Ÿ

### ä¸‰è·¯å¬å›ç­–ç•¥

**è·¯å¾„1ï¼šç›¸ä¼¼Ideaå¬å›** (Idea â†’ Idea â†’ Pattern)
```
ç”¨æˆ·è¾“å…¥Idea
  â†“ [å‘é‡ç›¸ä¼¼åº¦è®¡ç®—]
æ‰¾åˆ°æœ€ç›¸ä¼¼çš„ K ä¸ªå·²æœ‰Idea
  â†“ [è·å–å…³è”Pattern]
ç›´æ¥æ¨èè¿™äº›Pattern
  â†“
å¾—åˆ†å æ¯”é€šå¸¸ > 50%ï¼ˆç›´æ¥ç›¸å…³ï¼‰
```

**è·¯å¾„2ï¼šé¢†åŸŸç›¸å…³æ€§å¬å›** (Idea â†’ Domain â†’ Pattern)
```
ç”¨æˆ·Ideaå±äºå“ªäº›Domain
  â†“ [é¢†åŸŸæƒé‡è®¡ç®—]
è¯¥Domainå†…è¡¨ç°æœ€å¥½çš„Pattern
  â†“ [æ•ˆæœå¢ç›Šè®¡ç®—]
æ¨è"é¢†åŸŸä¹‹æ˜Ÿ"Pattern
  â†“
å¾—åˆ†å æ¯”é€šå¸¸ 20-40%ï¼ˆé¢†åŸŸç›¸å…³ä½†ä¸ç›´æ¥ï¼‰
```

**è·¯å¾„3ï¼šç›¸ä¼¼Paperå¬å›** (Idea â†’ Paper â†’ Pattern)
```
æ‰¾åˆ°ä¸ç”¨æˆ·Ideaç›¸ä¼¼çš„é«˜è´¨é‡è®ºæ–‡
  â†“ [è®ºæ–‡è´¨é‡è¯„åˆ†]
è¿™äº›è®ºæ–‡ä½¿ç”¨çš„Pattern
  â†“ [è´¨é‡åå‘èƒŒä¹¦]
é«˜è´¨é‡è®ºæ–‡æ¨èçš„Patternå¯ä¿¡åº¦é«˜
  â†“
å¾—åˆ†å æ¯”é€šå¸¸ 20-40%ï¼ˆè´¨é‡ä¿è¯ï¼‰
```

### ç»“æœèåˆä¸è§£è¯»

```python
æœ€ç»ˆå¾—åˆ† = Path1_Score * 0.4 + Path2_Score * 0.3 + Path3_Score * 0.3
```

**è§£è¯»æŠ€å·§**ï¼š

| å¾—åˆ†å æ¯”æ¨¡å¼ | è§£é‡Š | å»ºè®® |
| :--- | :--- | :--- |
| **è·¯å¾„1 > 70%** | ç”¨æˆ·Idea ä¸å†å²ç›¸ä¼¼ | âœ… ç¨³å¦¥é€‰æ‹© |
| **è·¯å¾„2 > 40%** | Pattern åœ¨é¢†åŸŸè¡¨ç°å¥½ | âœ… é¢†åŸŸé€šç”¨ |
| **è·¯å¾„3 > 40%** | é«˜è´¨é‡PaperèƒŒä¹¦ | âœ… è´¨é‡ä¿è¯ |
| **ä¸‰è·¯å‡è¡¡** | å„è§’åº¦éƒ½æ”¯æŒ | â­ æœ€ä½³é€‰æ‹© |

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- **çŸ¥è¯†å›¾è°±ä½“ç³»**ï¼šè§ `docs/RECALL_SYSTEM_EXPLAINED.md`
  - Pattern èšç±»é€»è¾‘è¯¦è§£
  - èŠ‚ç‚¹/è¾¹å®šä¹‰ä¸è§„æ¨¡
  - ä¸‰è·¯å¬å›ç­–ç•¥å·¥ä½œæœºåˆ¶
  - å®é™…æ¡ˆä¾‹åˆ†æï¼ˆRecall_Case_1ï¼‰
  - èšç±»æ”¹è¿›å‰åå¯¹æ¯”

- **ç›´è§‚æ¼”ç¤º**ï¼šè§ `docs/recall_case_1`
  - çœŸå® Idea çš„ä¸‰è·¯å¬å›è¾“å‡º
  - Top-10 Pattern æ’å
  - æ¯ä¸ª Pattern çš„è¯¦ç»†ä¿¡æ¯

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: Embedding API æŠ¥é”™ (401/403)

**åŸå› **ï¼šSiliconFlow API Key é…ç½®é”™è¯¯

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥API Keyæ˜¯å¦æ­£ç¡®
echo $SILICONFLOW_API_KEY

# æˆ–åœ¨è„šæœ¬ä¸­ç›´æ¥é…ç½®
# scripts/generate_patterns.py ç¬¬ 20-31 è¡Œ
```

### Q2: èšç±»è€—æ—¶å¾ˆé•¿

**åŸå› **ï¼šEmbedding API è°ƒç”¨é¢‘ç¹ï¼Œæœ‰é¢‘ç‡é™åˆ¶

**ä¼˜åŒ–**ï¼š
```python
# scripts/generate_patterns.py ç¬¬ 179-180 è¡Œ
time.sleep(0.1)  # è°ƒå¤§é—´éš”ï¼Œå¦‚ 0.2 æˆ– 0.3
```

### Q3: å¬å›ç»“æœä¸º 0

**åŸå› **ï¼š
1. ä¸­æ–‡ Idea åˆ†è¯é—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰
2. çŸ¥è¯†å›¾è°±æœªæ­£ç¡®æ„å»º
3. ç›¸ä¼¼åº¦é˜ˆå€¼è¿‡é«˜

**è°ƒè¯•**ï¼š
```python
# scripts/simple_recall_demo.py
# æ·»åŠ è°ƒè¯•è¾“å‡º
print(f"æ‰¾åˆ° {len(similar_ideas)} ä¸ªç›¸ä¼¼Idea")
print(f"Top-1 ç›¸ä¼¼åº¦: {similarities[0] if similarities else 'N/A'}")
```

### Q4: Pattern æ•°é‡ä¸é¢„æœŸä¸ç¬¦

**æ£€æŸ¥**ï¼š
```python
# æŸ¥çœ‹èšç±»ç»Ÿè®¡
import json
with open('output/patterns_statistics.json') as f:
    stats = json.load(f)
    print(f"Pattern æ•°: {stats['total_patterns']}")
    print(f"è¦†ç›–è®ºæ–‡æ•°: {stats['total_papers']}")
    print(f"ç°‡å¤§å°åˆ†å¸ƒ: {stats['cluster_size_distribution']}")
```

---

## ğŸ“ˆ æ€§èƒ½å‚è€ƒ

åŸºäº 545 ç¯‡è®ºæ–‡çš„æ¼”ç¤ºæ•°æ®é›†ï¼š

| æ“ä½œ | è€—æ—¶ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| åŠ è½½è®ºæ–‡ | ~1ç§’ | ä»ç£ç›˜è¯»å– |
| æ„å»ºEmbeddings | ~5-10åˆ†é’Ÿ | éœ€è¦è°ƒç”¨APIï¼Œå—ç½‘ç»œé™åˆ¶ |
| èšç±» | ~1ç§’ | æœ¬åœ°è®¡ç®— |
| ç”ŸæˆPatternæ‘˜è¦ | ~3-5åˆ†é’Ÿ | è°ƒç”¨LLMç”Ÿæˆ |
| æ„å»ºå›¾è°± | ~2ç§’ | æœ¬åœ°è®¡ç®— |
| å•æ¬¡å¬å› | ~1ç§’ | å®æ—¶è®¡ç®—ç›¸ä¼¼åº¦ |



